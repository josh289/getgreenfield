---
import Section from '../shared/Section.astro';
import SectionTitle from '../shared/SectionTitle.astro';

const topics = [
  {
    title: 'CQRS + Event Sourcing',
    content: 'Commands and queries are separated at the architecture level. Every state change is an immutable event stored in PostgreSQL. You get a complete audit trail, temporal queries, and the ability to rebuild any projection from the event stream. Read models are eventually consistent, projected from the event store through dedicated event handlers.',
  },
  {
    title: 'Multi-Agent Coordination',
    content: 'Each phase of the workflow runs a specialized agent. Code explorers analyze the existing codebase in parallel before architecture begins. The architecture planner builds DDD artifacts and records every significant decision. A workflow synthesizer derives process definitions from event chains â€” not from documentation written separately. Feature and spec agents run in parallel to produce everything the implementation agent needs. The implementation agent reads the spec. It does not improvise. A validator checks every handler using AST analysis before quality gates run. Each agent has a defined scope. None of them freelance outside it.',
  },
  {
    title: 'Spec-Driven Development',
    content: 'No handler gets written until the spec says exactly what it should look like. Not pseudocode. Not a description. A TypeScript template: the decorator, the base class, the method signature, the import path. The implementation agent reads the spec and builds to it. When it is done, a pattern validator checks every handler using AST analysis. Wrong decorator. Wrong base class. Wrong signature. Fail. Fix it. Run again.',
  },
  {
    title: 'Type-Safe Contract System',
    content: 'Services declare typed input/output contracts using TypeScript const types. Contracts are validated at compile time, not runtime. No magic strings. When a service changes its contract, every consumer knows at compile time. Validation decorators define runtime schemas without build-time code generation.',
  },
  {
    title: 'Two-Layer Authorization',
    content: 'Layer 1: Permission-based access control at the API gateway. Every route maps to a required permission. No permission, no access. Layer 2: Business-rule policy enforcement inside each handler. The data itself determines what is allowed. Both layers are mandatory, tested, and audited.',
  },
  {
    title: 'Zero Infrastructure Code',
    content: 'Services contain only domain logic. A service starts with one line: BaseService.start({ name: \'my-service\', version: \'1.0.0\' }). RabbitMQ messaging, PostgreSQL persistence, Redis caching, OpenTelemetry tracing, Prometheus metrics, all provided by the platform. Handlers are auto-discovered by folder convention: /commands/, /queries/, /events/.',
  },
  {
    title: 'Observability Built In',
    content: 'OpenTelemetry instrumentation on every service. Jaeger for distributed tracing. Prometheus for metrics collection. Grafana for dashboards. Every request is traceable across service boundaries. Every event is logged. Every error has context.',
  },
  {
    title: 'BPMN Workflow Synthesis',
    content: 'Workflow diagrams are derived from the architecture, not drawn alongside it. After the architecture phase produces interaction maps and event chains, a workflow synthesizer reads those artifacts and generates BPMN definitions. If the event chain changes, the workflow definition changes. Documentation cannot drift from the architecture because it is generated from the architecture.',
  },
];
---

<Section>
  <SectionTitle
    eyebrow="Under the Hood"
    title="For the engineers in the room."
    subtitle="If you are evaluating the technical foundation, here is what is under the hood."
  />
  <div class="space-y-4 max-w-3xl">
    {topics.map((topic, i) => (
      <details class="group rounded-xl border border-ev-default bg-ev-primary overflow-hidden" data-reveal data-delay={String((i + 1) * 100)}>
        <summary class="flex items-center justify-between cursor-pointer px-6 py-4 text-ev-text font-medium hover:text-sprout transition-colors">
          <span>{topic.title}</span>
          <svg class="w-5 h-5 text-ev-text-muted shrink-0 ml-4 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </summary>
        <div class="px-6 pb-4 text-ev-text-secondary leading-relaxed">
          {topic.content}
        </div>
      </details>
    ))}
  </div>
</Section>
